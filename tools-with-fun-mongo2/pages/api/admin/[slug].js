import dbConnect from '../../../lib/db'; import Tool from '../../../models/Tool'; import jwt from 'jsonwebtoken'; import cookie from 'cookie';
const JWT_SECRET = process.env.JWT_SECRET || 'devsecret'; function verify(req){ const cookies = req.headers.cookie ? cookie.parse(req.headers.cookie) : {}; const token = cookies.token || null; if(!token) return null; try{ return jwt.verify(token, JWT_SECRET) }catch(e){ return null } }
export default async function handler(req,res){ await dbConnect(); const user = verify(req); if(!user) return res.status(401).json({error:'unauthorized'}); if(req.method==='DELETE'){ const { slug } = req.query; try{ await Tool.deleteOne({slug}); return res.status(200).json({ok:true}) }catch(e){ return res.status(500).json({error:e.message}) } } else return res.status(405).json({error:'method not allowed'}) }
